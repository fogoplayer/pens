<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cistercian</title>
  </head>
  <body>
    <label>Original</label>
    <textarea
      class="original"
      placeholder="Place some text here and see what happens"
    ></textarea>
    <label>Formatted</label>
    <div class="cistercian">
      􀀂􀀓􀀂􀀕􀀊􀀂􀀔􀀉􀀂􀀔􀀋􀀂􀀕􀀃􀀂􀀎􀀄􀀂􀀕􀀌􀀇􀀂􀀕􀀌􀀃􀀂􀀕􀀋􀀂􀀕􀀃􀀂􀀎􀀄􀀂􀀕􀀌􀀈􀀂􀀕􀀃􀀂􀀕􀀍􀀂􀀕􀀌􀀈􀀂􀀎􀀄􀀂􀀕􀀆􀀂􀀕􀀃􀀂􀀕􀀌􀀆􀀂􀀕􀀃􀀂􀀎􀀄􀀂􀀔􀀉􀀂􀀕􀀌􀀂􀀕􀀂􀀎􀀄􀀂􀀕􀀌􀀇􀀂􀀕􀀃􀀂􀀕􀀃􀀂􀀎􀀄􀀂􀀕􀀌􀀋􀀂􀀕􀀆􀀂􀀔􀀉􀀂􀀕􀀌􀀈􀀂􀀎􀀄􀀂􀀕􀀆􀀂􀀔􀀉􀀂􀀕􀀌􀀄􀀂􀀕􀀌􀀄􀀂􀀕􀀃􀀂􀀕􀀌􀀂􀀕􀀌􀀇
    </div>
  </body>
  <style>
    @font-face {
      font-family: Cistercian;
      src: local("Cistercian"), url(./FRBCistercian.woff2);
      font-style: normal;
      font-weight: 400;
      font-display: block;
    }

    body {
      display: flex;
      flex-flow: column nowrap;
      align-items: stretch;
    }

    .cistercian {
      font-family: Cistercian;
      display: grid;
      place-items: center;
      font-size: 10em;
    }

    label {
      display: none;
    }
  </style>
  <script>
    const source = document.querySelector(".original");
    const output = document.querySelector(".cistercian");

    source.addEventListener("input", (e) => {
      output.innerText = formatText(e.target.value);
    });

    function formatText(text) {
      const origText = text;
      text = text.split(/\s/g);

      // if contains more than numbers
      if (!origText.match(/^[0-9]*$/)) {
        text = text.map((word) =>
          Array.from(word).map((char) => {
            if (char.match(/\s/)) return char;
            return String(char.charCodeAt(0)).padStart(4, 0);
          })
        );
      } else {
        text = text.map((word) => {
          let retVal = [];
          word = Array.from(word);

          while (word.length > 0) {
            retVal.push(word.splice(0, 4).join(""));
          }
          return retVal;
        });
      }

      // Break up text that is too long
      let formattedText = "";
      while (text.length > 0) {
        let [word] = text.splice(0, 1);
        console.log(JSON.stringify(word));
        while (word.length > 0) {
          const sample = parseInt(word.splice(0, 1));
          console.log(sample);
          formattedText += number2cistercian(sample);
        }
        formattedText += " ";
      }

      return formattedText;
    }

    function resizeText() {
      output.scrollHeight;
    }

    //////////////////////////////////////////////////////////////////////////////////////////
    // Adapted from https://github.com/mrled/cistercianjs/blob/master/lib/all/cistercian.ts //
    //////////////////////////////////////////////////////////////////////////////////////////
    function getDigit(num, power) {
      return Math.floor((num / Math.pow(10, power)) % 10);
    }

    /* Convert a 1-4 digit decimal number to an array of
     * [thousands, hundreds, tens, ones], also called KHTU.
     */
    function khtu(num) {
      if (num < 0 || num > 9999) {
        throw "khtu only supports numbers between 0-9999 (inclusive)";
      }
      return [
        getDigit(num, 3),
        getDigit(num, 2),
        getDigit(num, 1),
        getDigit(num, 0),
      ];
    }

    function number2cistercian(num) {
      const digits = khtu(num);
      let result = [0x100002];
      if (digits[0] > 0) {
        result.push(0x10001e + digits[0] - 1);
      }
      if (digits[1] > 0) {
        result.push(0x100015 + digits[1] - 1);
      }
      if (digits[2] > 0) {
        result.push(0x10000c + digits[2] - 1);
      }
      if (digits[3] > 0) {
        result.push(0x100002 + digits[3]);
      }

      console.log(
        `number2cistercian(${num}): ${result.map((char) => char.toString(16))}`
      );

      return String.fromCodePoint(...result);
    }
  </script>
</html>
